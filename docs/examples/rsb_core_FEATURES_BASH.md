# Bash Utilities (FEATURES_BASH)

Updated: 2025-09-30

Scope
- Curated wrappers and macros for common bash-style commands (curl, tar, zip).
- Bash-style control flow macros (test!, case!, for_in!) for scripting.
- String-first, process-oriented helpers that delegate to the OS shell.

Module
- `rsb::bash` (module)
  - `bash::curl_get(url: &str) -> CmdResult`
  - `bash::curl_get_with_options(url: &str, options: &str) -> CmdResult`
  - `bash::curl_post(url: &str, data: &str) -> CmdResult`
  - `bash::curl::{get, get_opts, post}` — ergonomic aliases
  - `bash::http_get`, `http_get_with_options`, `http_post` — back-compat helpers that forward to the curl variants
  - Archives:
    - `bash::create_tar`, `create_tar_gz`, `extract_tar`, `list_tar`
    - `bash::create_zip`, `extract_zip`, `list_zip`

Safety
- Shell quoting: URLs and POST data are wrapped with `string::utils::shell_single_quote` to avoid injection and parsing issues.
- These wrappers call `sh -c` via `os::run_cmd_with_status` and return `CmdResult` (no panic).

Macros (module-owned)
- **Network:**
  - `curl!(url)` → String (stdout) or exits on failure
  - `curl!(url, options: "-I")` → String
  - `curl!(post: url, data: payload)` → String
  - `get!(url, ...)` — shortcut alias for the `curl!` macro

- **Archives** (defined at crate level; re-exported under `bash::macros`):
  - `tar!(create: "a.tar", "file")`, `tar!(extract: "a.tar", to: "dest/")`, `tar!(list: "a.tar")`
  - `tar_gz!(create: "a.tar.gz", "file")`
  - `zip!(create: "a.zip", "dir")`, `zip!(extract: "a.zip", to: "dest/")`, `zip!(list: "a.zip")`
  - `pack!("archive.ext", paths...)` auto-detects format by extension

- **Bash-style Control Flow:**
  - `test!(-f path)` — filesystem tests: `-f`, `-d`, `-e`, `-L`, `-r`, `-w`, `-x`, `-s`
  - `test!(-n str)`, `test!(-z str)` — string tests
  - `test!(a, ==, b)`, `test!(a, !=, b)`, `test!(a, =~, regex)` — string comparisons
  - `test!(a, -eq, b)`, `test!(a, -lt, b)`, `test!(a, -gt, b)`, etc. — numeric comparisons
  - `case!(value, { "pattern" => { body }, _ => { default } })` — pattern matching with regex
  - `for_in!(item in "array_name" => { body })` — iterate over global arrays
  - `for_in!(i, item in "array_name" => { body })` — indexed iteration

Examples
```rust
use rsb::prelude::*;

// Network
let body = curl!("https://example.com");
let head = curl!("https://example.com", options: "-I");
let resp = curl!(post: "https://example.com", data: "a=1&b=2");

// Control flow
if test!(-f "/etc/passwd") {
    println!("File exists");
}

case!("production", {
    "prod.*" => { println!("Production environment") },
    "dev.*" => { println!("Development environment") },
    _ => { println!("Unknown environment") }
});

set_array("items", &["a", "b", "c"]);
for_in!(item in "items" => {
    println!("Item: {}", get_var("item"));
});
```

Testing
- Sanity: `tests/bash_sanity.rs` → `tests/bash/sanity.rs`
- UAT: `tests/uat_bash.rs` → `tests/uat/bash.rs` (visible outputs, non-fatal on command errors)

Notes
- For programmatic HTTP, consider a gated Rust HTTP client in the future.
- Archive commands depend on system `tar`/`zip`/`unzip` availability.

<!-- feat:bash -->

_Generated by bin/feat2.py --update-doc._

* `src/bash/jq.rs`
  - fn jq_get (line 8)
  - fn jq_get_file (line 22)

* `src/bash/macros.rs`
  - macro curl! (line 9)
  - macro get! (line 40)
  - macro test! (line 49)
  - macro case! (line 117)
  - macro for_in! (line 137)
  - pub use crate::{pack, tar, tar_gz, unpack, zip} (line 157)

* `src/bash/mod.rs`
  - pub use utils::* (line 8)

* `src/bash/utils.rs`
  - fn curl_get (line 9)
  - fn curl_get_with_options (line 16)
  - fn curl_post (line 23)
  - fn get (line 33)
  - fn get_opts (line 36)
  - fn post (line 39)
  - fn http_get (line 45)
  - fn http_get_with_options (line 48)
  - fn http_post (line 51)
  - fn create_tar (line 58)
  - fn create_tar_gz (line 65)
  - fn extract_tar (line 72)
  - fn list_tar (line 82)
  - fn create_zip (line 88)
  - fn extract_zip (line 95)
  - fn list_zip (line 105)

<!-- /feat:bash -->

