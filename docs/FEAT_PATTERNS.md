# FEAT Documentation Patterns

**Reference Guide for feat.py Ecosystem**
**Generated**: 2025-10-08
**Based on**: 271 FEATURES_*.md files across Rust projects

## Overview

This document describes common patterns found in FEATURES_*.md documentation files used with the feat.py/feat2.py tooling system. These patterns represent conventions established across multiple Rust projects using the RSB (Rust Standard Bash) framework and custom applications.

## Core Concept

FEATURES files serve dual purposes:
1. **Human-readable documentation** - Markdown format with examples, API surface, usage patterns
2. **Machine-parseable metadata** - Sentinel blocks containing auto-generated API surface from source code

## Sentinel Block Pattern

### Basic Structure

All FEATURES files use sentinel blocks to delimit auto-generated content:

```markdown
<!-- feat:FEATURE_NAME -->

_Generated by bin/feat2.py --update-doc._

* `src/path/to/file.rs`
  - pub use module::* (line 10)
  - fn function_name (line 25)
  - struct StructName (line 40)

<!-- /feat:FEATURE_NAME -->
```

### Sentinel Block Rules

1. **Opening tag**: `<!-- feat:FEATURE_NAME -->` (lowercase feature name)
2. **Generation marker**: `_Generated by bin/feat2.py --update-doc._` or similar
3. **Content**: Bullet list of files and their exported items
4. **Closing tag**: `<!-- /feat:FEATURE_NAME -->` (matches opening)

### Multiple Sentinel Blocks

Some files may have multiple sentinel blocks for different aspects:
```markdown
<!-- feat:colors -->
... primary feature content ...
<!-- /feat:colors -->

<!-- feat:colors:glyphs -->
... sub-feature content ...
<!-- /feat:colors:glyphs -->
```

## Common File Structures

### Pattern 1: Minimal/Stub Format

For planned features or minimal modules:

```markdown
# Feature Name

> **Note**: This is a stub documentation file. Rename to `.md` when ready to finalize.

## Overview

TODO: Describe the purpose and scope of this feature.

## Usage

TODO: Provide usage examples.

## API Surface

<!-- feat:feature_name -->
_Generated by bin/feat2.py --update-doc._
... auto-generated content ...
<!-- /feat:feature_name -->
```

**Examples**:
- `FEATURES_STREAMS.stub.md` (120 lines)
- `FEATURES_PATH.stub.md` (20 lines)

### Pattern 2: Standard RSB Feature

For library features with moderate complexity:

```markdown
# RSB Feature Name (MODERN + SPEC_ALIGNED)

Updated: YYYY-MM-DD

Purpose
- High-level purpose statement
- Design philosophy
- Usage context

Module State (SPEC Alignment)
- MODERN: Current architectural state
- SPEC_ALIGNED: Standards compliance notes

Feature Flags (Cargo.toml)
- List of feature flags
- Dependencies between features
- Optional/required components

Public API (curated; not in prelude)
```rust
use rsb::feature::{
  function_one, function_two, StructName,
};
```

Runtime Model
- Configuration options
- Behavior switches
- Environment variables

Examples
```rust
// Practical usage examples
```

Testing (HOWTO_TEST)
- Test commands
- Feature flags for testing
- Test organization

<!-- feat:feature_name -->
... auto-generated API surface ...
<!-- /feat:feature_name -->
```

**Examples**:
- `FEATURES_COLORS.md` (~200 lines, ~8.6K)
- `FEATURES_CLI.md` (~180-245 lines)
- `FEATURES_GLOBAL.md` (~228-289 lines)

### Pattern 3: Application Feature (Complex)

For application-specific features with detailed documentation:

```markdown
# Application Module Name

Updated: YYYY-MM-DD

## Purpose
- Multi-point purpose description
- System integration context
- Design goals

## Feature Flags
- Feature flag listings with descriptions
- Default states

## Imports
```rust
use app::module::{
    TypeOne,
    TypeTwo,
    TraitName,
};
```

## Core API

### Subsection Name (`source_file.rs`)
- `TypeName` â€” Description
  - Field/method details
  - Variants (for enums)
  - Associated types

### Another Subsection
- More organized API documentation

## Patterns
- Design patterns used
- Architectural decisions
- Integration strategies

## Examples

### Use Case One
```rust
// Detailed example
```

### Use Case Two
```rust
// Another example
```

## Integration
- **Module A**: How this integrates with A
- **Module B**: How this integrates with B

## Testing
- Test organization
- Coverage expectations
- Test execution

## Performance Characteristics
- Runtime characteristics
- Memory usage
- Optimization notes

## Limitations
- Known limitations
- Edge cases
- Workarounds

## Status
- MODERN: Yes/No with explanation
- SPEC_ALIGNED: Yes/No with explanation

## Changelog
- Date: Change description

## References
- Related documentation
- External specifications

---

<!-- feat:feature_name -->
_Generated by bin/feat2.py --update-doc._
... auto-generated content ...
<!-- /feat:feature_name -->
```

**Examples**:
- `FEATURES_CORE.md` (Cage, ~476 lines, ~15K)
- `FEATURES_MGR.md` (Cage, ~647 lines, ~21K)
- `FEATURES_KEYGEN.md` (Cage, ~516 lines, ~19K)

### Pattern 4: Layout/Formatting Feature

For custom formatting or layout tools:

```markdown
# FEATURES_NAME.md - Module Description

**Version**: vX.Y.Z
**Date**: YYYY-MM-DD
**Tasks**: TASK-XXX (N Story Points)
**Status**: Complete âœ… / In Progress ðŸš§

## Overview

Brief description of the module's purpose and functionality.

## Core Features

### 1. Feature Category
- **Item**: Description with details
- **Flexibility**: Use case variations

### 2. Another Category
- Organized feature listings

## Usage Patterns

### Pattern Name
```rust
// Example code showing usage
```

## API Reference

### Section Name

#### `function_name(args) -> Result<T, E>`
Description of function.
- **Parameters**: Parameter details
- **Returns**: Return value description
- **Status**: Implementation status notes

## Module Structure

### RSB MODULE_SPEC Compliance
```
Directory structure visualization
```

## Testing Strategy

### Test Categories
- Category descriptions

### Test Coverage
```rust
// Test examples and coverage notes
```

## Design Principles

### Principle Name
- Design philosophy points

## Integration Points

### Module Name (Future/Current)
Integration description.

## Performance

### Metric Category
- Performance characteristics

---

**RSB Compliance**: Status indicators
**Integration**: Integration status
**Quality**: Test and quality metrics
```

**Examples**:
- `FEATURES_PRELUDE.md` (Rolo, ~237 lines, ~7.4K)
- `FEATURES_LAYOUT_MODES.md` (Rolo, ~376 lines, ~13.4K)

## API Surface List Patterns

### File Entry Format

```markdown
* `relative/path/to/file.rs`
  - pub use module::* (line N)
  - fn function_name (line N)
  - struct StructName (line N)
  - enum EnumName (line N)
  - trait TraitName (line N)
  - macro macro_name! (line N)
```

### Sorting and Organization

1. **Files**: Listed in alphabetical order
2. **Items within file**: Typically in source code order (not alphabetical)
3. **Line numbers**: Always included for traceability

### Item Type Indicators

Common item types found in sentinel blocks:
- `pub use` - Re-exports from other modules
- `fn` - Functions (both pub and private shown)
- `struct` - Structure definitions
- `enum` - Enumeration types
- `trait` - Trait definitions
- `macro` - Macro definitions
- `impl` - Implementation blocks (sometimes)
- `const` - Constants (occasionally)

## Feature Naming Conventions

### RSB Standard Features (UPPERCASE)

RSB framework features use uppercase names:
- BASH, CLI, COLORS, DATE, DEV
- FS, GENERATORS, GLOBAL, HOST
- MATH, OBJECT, OPTIONS, PARAMS, PARSE
- PROGRESS, PROMPTS, REPL, STRINGS
- TESTING, THREADS, TOKENS, TOML
- TRUTH, VISUALS

### Application Features (Mixed Case)

Application-specific features may use:
- Uppercase: CORE, MGR, KEYGEN, FORGE, PTY, ADP, AUDIT, BUFF
- Mixed: COLUMN_MODE, LAYOUT_MODES, TABLE_MODE
- Descriptive: GATING_PLAN, TEST_INFRASTRUCTURE, VISUAL_UAT

### Stub Indicator

Unfinished features use `.stub.md` extension:
- `FEATURES_STREAMS.stub.md`
- `FEATURES_LOGGING.stub.md`
- `FEATURES_UTILS.stub.md`

## Common Sections

### Essential Sections (Most Files)

1. **Title/Header** - Feature name and status markers
2. **Updated Date** - Last modification date
3. **Purpose** - Why this feature exists
4. **Public API** - How to import and use
5. **Examples** - Practical code samples
6. **Sentinel Block** - Auto-generated API surface

### Common Optional Sections

- **Feature Flags** - Cargo.toml feature configuration
- **Runtime Model** - Configuration and behavior switches
- **Testing** - How to test this feature
- **Module State** - MODERN/SPEC_ALIGNED status
- **Integration** - How this works with other modules
- **Performance** - Characteristics and limitations
- **Status/Changelog** - Implementation status and history
- **References** - Links to related docs

## Metadata Patterns

### Status Indicators

```markdown
**Status**: Complete âœ…
**Status**: In Progress ðŸš§
**Status**: Planned ðŸ“‹
```

### Version Information

```markdown
**Version**: v0.1.0
**Date**: 2025-09-15
**Tasks**: TASK-003 (2 Story Points)
```

### Compliance Markers

```markdown
Module State (SPEC Alignment)
- MODERN: Yes - Description of modern architecture
- SPEC_ALIGNED: Yes - Standards compliance notes
```

Or at the end:
```markdown
**RSB Compliance**: âœ… MODULE_SPEC prelude patterns
**Integration**: âœ… Cross-module access
**Quality**: âœ… 12/12 tests passing
```

## Code Block Conventions

### Rust Code Examples

````markdown
```rust
use module::path::{TypeA, TypeB};

fn example() -> Result<(), Error> {
    // Implementation
    Ok(())
}
```
````

### Import Sections

````markdown
```rust
use crate::feature::{
    FunctionOne,
    FunctionTwo,
    StructName,
};
```
````

### Shell Commands

````markdown
```bash
cargo test --features feature_name
./bin/test.sh run all
```
````

## File Size Patterns

Based on analysis of 271 files:

| Size Category | Lines | Bytes | Typical Features |
|---------------|-------|-------|------------------|
| Tiny | 20-50 | <1K | Stubs, minimal utilities |
| Small | 50-100 | 1-3K | BASH, DATE, DEV, PARSE, THREADS |
| Medium | 100-250 | 3-12K | CLI, COLORS, FS, GLOBAL, OPTIONS, PARAMS, PROMPTS, STRINGS |
| Large | 250-500 | 12-20K | MATH, TESTING, TOKENS, VISUALS, TOML, App features |
| Very Large | 500+ | 20K+ | OBJECT (legacy), MGR, KEYGEN |

## Configuration (.feat.toml) Patterns

### Basic Structure

```toml
# feat2.py configuration
# Auto-generated on /path/to/project

features_root = "src"
docs_root = "docs/features"
doc_pattern = "FEATURES_{FEATURE}.md"
languages = ["rust"]
auto_discover = true

exclude = [
    "**/tests/**",
    "**/target/**",
    "**/__pycache__/**",
]

[features]
# Explicit mappings when feature name != directory name
strings = ["src/string"]
tokens = ["src/token"]
colors = ["src/colors"]
```

### Feature Mapping Patterns

```toml
[features]
# Single-path feature
feature_name = ["src/feature_name"]

# Multi-path feature
cli = ["src/cli", "src/cli/macros.rs"]

# Renamed feature (name != path)
strings = ["src/string"]
generators = ["src/gx"]
```

## Common Feature Patterns

### Multi-Package Features (Colors Example)

Features often have hierarchical structure:
- `colors-core` - Base functionality
- `colors-simple` - 8/16 color palette
- `colors-status` - Status colors (success/warn/error)
- `colors-named` - Extended color names
- `colors-all` - Convenience bundle
- `visual` - Integration with visual helpers

### Test Features

Testing sections commonly include:
```markdown
Testing (HOWTO_TEST)
- Default tests: `cargo test`
- Feature tests: `cargo test --features feature_name`
- Full suite: `./bin/test.sh run all`
```

### Prelude Exclusions

Common note in RSB features:
```markdown
Public API (curated; not in prelude)
```

This indicates the feature is intentionally excluded from the prelude to keep it lean.

## Anti-Patterns (What to Avoid)

1. **Missing Sentinel Blocks** - Every FEATURES file should have auto-generated content
2. **Mismatched Sentinel Tags** - Opening and closing tags must match exactly
3. **Manual API Surface** - Content between sentinels should be auto-generated only
4. **Inconsistent Naming** - Feature names should match across filename, sentinel, and .feat.toml
5. **Outdated Updated Dates** - Should reflect last actual modification
6. **Missing Examples** - Most features should have practical code examples

## Tool Integration

### feat.py / feat2.py

The Python tools that manage these files:
- Parse source code to extract public API
- Update sentinel blocks with current API surface
- Respect existing documentation outside sentinel blocks
- Support multiple languages (primarily Rust)

### Expected Workflow

1. Write/modify source code
2. Write/update documentation (outside sentinel blocks)
3. Run `feat2.py --update-doc`
4. Tool updates API surface between sentinels
5. Review and commit both source and docs

## Examples Location

Representative examples copied to:
```
~/repos/code/python/snekfx/feat-py/docs/examples/
â”œâ”€â”€ rsb_porty_FEATURES_COLORS.md          # Medium RSB (200 lines)
â”œâ”€â”€ rsb_core_FEATURES_BASH.md             # Small RSB (119 lines)
â”œâ”€â”€ cage_FEATURES_CORE.md                 # Large app (476 lines)
â”œâ”€â”€ rolo_FEATURES_PRELUDE.md              # Medium app (237 lines)
â”œâ”€â”€ rsb_FEATURES_STREAMS.stub.md          # Stub (120 lines)
â”œâ”€â”€ rsb_FEATURES_OBJECT_legacy.md         # Very large (889 lines)
â”œâ”€â”€ rsb_example.feat.toml                 # RSB config
â””â”€â”€ cage_example.feat.toml                # App config
```

## Additional Resources

- **Full Inventory**: See `~/repos/docs/brain/rx/feat_docs_inventory.md`
- **Source Projects**: `~/repos/code/rust/prods/`
- **RSB Core**: `~/repos/code/rust/prods/oodx/rsb/`
- **Example Apps**: Cage (skull/cage), Rolo (vizo/rolo)

## Summary

FEATURES documentation follows these key principles:

1. **Dual Purpose**: Human docs + machine-parseable API surface
2. **Sentinel Separation**: Clear boundaries between manual and generated content
3. **Consistent Structure**: Common sections across similar features
4. **Auto-Generation**: API surface always reflects current source code
5. **Categorization**: Features grouped by size, type, and purpose
6. **Configuration**: .feat.toml drives tool behavior and mappings

These patterns enable maintainable, accurate documentation that scales across large codebases with multiple projects and hundreds of features.
